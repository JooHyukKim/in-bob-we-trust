name: Test delivery-info-service

on:
  push:
    branches:
      - \#142-docker-compose-를-활용한-서버-성능테스트
jobs:
  #----------------------------------------------------------------------------------------------------------
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'
          cache: 'gradle'

      - name: Start Logging
        run: echo Gradle Build Test Start

      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      - name: Gradle BootJar
        if: success()
        run: ./gradlew :delivery-info-service:bootJar

      - name: Build Docker Image
        if: success()
        run: docker image build -t inbobwetrust/delivery-info-service:actions-test ./delivery-info-service

      - name: Docker-Compose up
        if: success()
        run: docker-compose -f ./k6-test/docker-compose.yml up -d

      - name: Run local k6 test
        uses: k6io/action@v0.1
        with:
          filename: ./k6-test/k6-scripts/simple-delivery-get.js

#  bootjar
#  build image
#  docker-compose -f ./k6-test/docker-compose.yml up -d
#  run with image
